<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Коллекция: {{ collection.name }}</title>
</head>
<body>
    <h1>Коллекция: {{ collection.name }}</h1>

    <h2>Фильтры</h2>
    <form method="get" action=".">
        <input type="text" name="q" placeholder="Поиск по названию" value="{{ request.GET.q }}">

        <div>
            <h3>Автор</h3>
            <select name="author">
                <option value="">Все авторы</option>
                {% for author in all_authors %}
                    <option value="{{ author.id }}" {% if request.GET.author == author.id|stringformat:"s" %}selected{% endif %}>{{ author.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <h3>Издатель</h3>
            <select name="publisher">
                <option value="">Все издатели</option>
                {% for publisher in all_publishers %}
                    <option value="{{ publisher.id }}" {% if request.GET.publisher == publisher.id|stringformat:"s" %}selected{% endif %}>{{ publisher.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <h3>Жанр</h3>
            <select name="genre">
                <option value="">Все жанры</option>
                {% for genre in all_genres %}
                    <option value="{{ genre.id }}" {% if request.GET.genre == genre.id|stringformat:"s" %}selected{% endif %}>{{ genre.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <h3>Метка</h3>
            <select name="tag">
                <option value="">Все метки</option>
                {% for tag in all_tags %}
                    <option value="{{ tag.id }}" {% if request.GET.tag == tag.id|stringformat:"s" %}selected{% endif %}>{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit">Применить</button>
    </form>

    <h2>Книги в коллекции</h2>
    <ul>
        {% for book in books %}
            <li>
                <h3><a href="{% url 'view_book' collection.id book.id %}">{{ book.title }}</a></h3>
                <p><strong>Автор:</strong> 
                    {% for author in book.authors.all %}
                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p><strong>Издатель:</strong> 
                    {% for publisher in book.publishers.all %}
                        {{ publisher.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p><strong>Жанр:</strong> 
                    {% for genre in book.genres.all %}
                        {{ genre.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p><strong>Метка:</strong> 
                    {% for tag in book.tags.all %}
                        {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p><strong>Комментарий:</strong> {{ book.comment }}</p>
            </li>
        {% endfor %}
    </ul>

    <a href="{% url 'add_book' collection.id %}">Добавить книгу</a> 
    <br>
    <a href="{% url 'choose_collection' %}">Назад к выбору коллекции</a>
</body>
</html>
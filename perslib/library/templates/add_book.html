{% extends 'base.html' %}
{% block content %}
  <h1>Добавить книгу в коллекцию: {{ collection.name }}</h1>

  <h2>Создать новую книгу</h2>
  <form method="post" enctype="multipart/form-data" action="{% url 'add_book' collection.id %}">
    {% csrf_token %}
    {{ book_form.as_p }}

    <h3>Авторы</h3>
    <div>
        <select name="authors" multiple> 
            {% for author in all_authors %}
                <option value="{{ author.id }}">{{ author.name }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{% url 'add_author' %}?collection_id={{ collection.id }}">Добавить автора</a>

    <h3>Издатели</h3>
    <div>
        <select name="publishers" multiple>
            {% for publisher in all_publishers %}
                <option value="{{ publisher.id }}">{{ publisher.name }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{% url 'add_publisher' %}?collection_id={{ collection.id }}">Добавить издателя</a>

    <h3>Жанры</h3>
    <div>
        <select name="genres" multiple>
            {% for genre in all_genres %}
                <option value="{{ genre.id }}">{{ genre.name }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{% url 'add_genre' %}?collection_id={{ collection.id }}">Добавить жанр</a>

    <h3>Метки</h3>
    <div>
        <select name="tags" multiple>
            {% for tag in all_tags %}
                <option value="{{ tag.id }}">{{ tag.name }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="{% url 'add_tag' %}?collection_id={{ collection.id }}">Добавить метку</a>

    <h3>Фотографии</h3>
    <input type="file" name="photos" accept="image/*" multiple> <br> 

    <button type="submit">Сохранить книгу</button>
</form>

<h2>Добавить существующую книгу</h2>
<form method="post" action="{% url 'add_book' collection.id %}">
    {% csrf_token %}
    <select name="book_id">
        {% for book in all_books %}
            <!-- Исключаем книги из текущей коллекции -->
            {% if book not in collection.books.all %}
                <option value="{{ book.id }}">{{ book.title }}</option>
            {% endif %}
        {% endfor %}
    </select>
    <button type="submit">Добавить книгу</button>
</form>

{% endblock %}